<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title Page-->
    <title>Редактирование задания : NCTaskManager</title>

    <!-- Fontfaces CSS-->
    <link href="/assets/css/font-face.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="/assets/vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="/assets/vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/assets/vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <!-- Main CSS-->
    <link href="/assets/css/theme.css" rel="stylesheet" media="all">

</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->
        <header class="header-mobile d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                            { NCTask }
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                        <li>
                            <a href="/">
                                <i class="fas fa-home"></i>Главная</a>
                        </li>
                        <li>
                            <a href="/calendar">
                                <i class="fas fa-calendar-alt"></i>Календарь</a>
                        </li>
                        <li class="active">
                            <a href="/task">
                                <i class="fas fa-list"></i>Список</a>
                        </li>
                        <li>
                            <a href="/info">
                                <i class="fas fa-info-circle"></i>Описание</a>
                        </li>
                        <li>
                            <a href="/logs">
                                <i class="fas fa-file-alt"></i>Логи</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- END HEADER MOBILE-->

        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <big><span class="text-warning">{</span> NCTaskManager <span class="text-warning">}</span></big>
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                        <li>
                            <a href="/">
                                <i class="fas fa-home"></i>Главная</a>
                        </li>
                        <li>
                            <a href="/calendar">
                                <i class="fas fa-calendar-alt"></i>Календарь</a>
                        </li>
                        <li class="active">
                            <a href="/task">
                                <i class="fas fa-list"></i>Список</a>
                        </li>
                        <li>
                            <a href="/info">
                                <i class="fas fa-info-circle"></i>Описание</a>
                        </li>
                        <li>
                            <a href="/logs">
                                <i class="fas fa-file-alt"></i>Логи</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="col-lg-12">
                            <div id="carouselExampleControls" class="carousel carousel-fade slide" data-ride="carousel" data-interval="3000">
                                <div class="carousel-inner" id="ws-alerts">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header">
                                        <strong>Редактирование</strong> задания
                                    </div>
                                    <form action="#"  th:action="@{/task/edit}" th:object="${task}" method="post" onsubmit="return validateForm()" enctype="multipart/form-data" class="form-horizontal">
                                        <div class="card-body card-block">
                                            <input type="hidden" th:field="*{id}" />

                                            <div class="row form-group">
                                                <div class="col-12 col-md-12" id="jsTaskAlerts">
                                                    <div class="alert alert-success" role="alert" th:text="${saveSuccess}" th:if="${saveSuccess}">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row form-group" th:if="${saveErrors}">
                                                <div class="col-12 col-md-12">
                                                    <div class="alert alert-danger" role="alert" th:text="${saveErrors}">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col-12 col-md-12" id="jTaskAlerts">
                                                    <div class="alert alert-danger" role="alert" th:each="err : ${#fields.errors('*')}" th:text="${err}">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label for="text-input" class=" form-control-label">Название</label>
                                                </div>
                                                <div class="col-12 col-md-9">
                                                    <input type="text" th:field="*{title}" placeholder="Введите текст" class="form-control">
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label for="text-input" class=" form-control-label">Дата начала</label>
                                                </div>
                                                <div class="col-12 col-md-3">
                                                    <input type="text" th:field="*{startTimeString}" readonly="readonly" placeholder="dd-mm-yyyy HH:MM" class="form-control">
                                                </div>
                                            </div>


                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label for="text-input" class=" form-control-label">Дата окончания</label>
                                                </div>
                                                <div class="col-12 col-md-3">
                                                    <input type="text"  th:field="*{endTimeString}" readonly="readonly" placeholder="dd-mm-yyyy HH:MM" class="form-control">
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label class=" form-control-label">Задание активно</label>
                                                </div>
                                                <div class="col col-md-9">
                                                    <div class="form-check">
                                                        <label class="switch switch-3d switch-primary mr-3">
															<input type="checkbox" th:field="*{active}" class="switch-input" checked="true">
															<span class="switch-label"></span>
															<span class="switch-handle"></span>
														</label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label class=" form-control-label">Задание повторяется</label>
                                                </div>
                                                <div class="col col-md-9">
                                                    <div class="form-check">
                                                        <label class="switch switch-3d switch-secondary mr-3">
															<input type="checkbox" th:field="*{repeated}" class="switch-input" checked="true" disabled="disabled">
															<span class="switch-label"></span>
															<span class="switch-handle"></span>
														</label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row form-group">
                                                <div class="col col-md-3">
                                                    <label for="text-input" class=" form-control-label">Интервал повторения</label>
                                                </div>
                                                <div class="col-12 col-md-3">
                                                    <input type="number" min="0"  th:field="*{repeatInterval}" placeholder="0.00" class="form-control">
                                                </div>
                                            </div>

                                    </div>
                                    <div class="card-footer">
                                        <button type="submit" class="btn btn-success btn-sm">
                                            <i class="fa fa-dot-circle-o"></i> Сохранить
                                        </button>
                                        <a href="/task" class="btn btn-danger btn-sm">
                                            <i class="fa fa-ban"></i> Отменить
                                        </a>
                                        <a href="/task" class="btn btn-secondary btn-sm">
                                            <i class="fa fa-level-up"></i> К списку
                                        </a>
                                    </div>
                                    </form>
                                </div>

                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="copyright">
                                    <p>Copyright © 2020 NCTaskManager</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Jquery JS-->
    <script src="/assets/vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="/assets/vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="/assets/vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="/assets/vendor/slick/slick.min.js">
    </script>
    <script src="/assets/vendor/wow/wow.min.js"></script>
    <script src="/assets/vendor/animsition/animsition.min.js"></script>
    <script src="/assets/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>
    <script src="/assets/vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="/assets/vendor/counter-up/jquery.counterup.min.js">
    </script>
    <script src="/assets/vendor/circle-progress/circle-progress.min.js"></script>
    <script src="/assets/vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/assets/vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="/assets/vendor/select2/select2.min.js">
    </script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment-with-locales.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
	<script>
        function validateForm() {
            if(DateFormatter('endTimeString').getTime() > DateFormatter('startTimeString').getTime() && parseInt($('#repeatInterval').val()) > 0){
                return true;
            }
            else if(DateFormatter('endTimeString').getTime() === DateFormatter('startTimeString').getTime() && parseInt($('#repeatInterval').val()) === 0){
                return true;
            }
            /*
            else if(DateFormatter('endTimeString').getTime() > DateFormatter('startTimeString').getTime() && parseInt($('#repeatInterval').val()) === 0){
                $("#jsTaskAlerts").html('<div class="alert alert-danger" role="alert"><b>Задание не сохранено:</b> Укажите интервал повторения!</div>');
                return false;
            }

             */
            else if(DateFormatter('endTimeString').getTime() === DateFormatter('startTimeString').getTime() && parseInt($('#repeatInterval').val()) > 0){
                $("#jsTaskAlerts").html('<div class="alert alert-danger" role="alert"><b>Задание не сохранено:</b> Укажите дату окончания отличающуюся от даты начала!</div>');
                return false;
            }
            else if(DateFormatter('endTimeString').getTime() < DateFormatter('startTimeString').getTime() && parseInt($('#repeatInterval').val()) > 0){
                $("#jsTaskAlerts").html('<div class="alert alert-danger" role="alert"><b>Задание не сохранено:</b> Дата окончания наступает раньше даты начала!</div>');
                return false;
            }
        }

        function DateFormatter(element){
            var parts = document.getElementById(element).value.split(' ');
            var dateParts = parts[0].split('-');
            var timeParts = parts[1].split(':');
            return new Date(parseInt(dateParts[2]), parseInt(dateParts[1])-1, parseInt(dateParts[0]),
                parseInt(timeParts[0]), parseInt(timeParts[1]), 0);
            // (YYYY, MM, DD, Hr, Min, Sec)
        }

		$(function() {
            moment.locale('ru');

			$('input[name="startTimeString"]').daterangepicker({
			singleDatePicker: true,
			timePicker: true,
			timePicker24Hour: true,
			//startDate: moment().startOf('hour'),
			locale: {
				format: 'DD-MM-YYYY HH:mm',
                applyLabel: "Подтвердить",
                cancelLabel: "Отмена"
			}
			});
			
			$('input[name="endTimeString"]').daterangepicker({
			singleDatePicker: true,
			timePicker: true,
			timePicker24Hour: true,
			//startDate: moment().startOf('hour'),
			locale: {
				format: 'DD-MM-YYYY HH:mm',
                applyLabel: "Подтвердить",
                cancelLabel: "Отмена"
			}
			});
		});
	</script>	

    <!-- Main JS-->
    <script src="/assets/js/main.js"></script>

    <!-- Websocket -->
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="/assets/js/app.js"></script>

</body>

</html>
<!-- end document-->
